- [위협 모델의 이해](#위협-모델의-이해)
  - [공격 지점 식별](#공격-지점-식별)
  - [위협 모델링](#위협-모델링)
    - [레벨 0: 데이터 흐름 파악](#레벨-0-데이터-흐름-파악)
    - [레벨 1: 데이터 처리 프로세스 분석](#레벨-1-데이터-처리-프로세스-분석)
    - [레벨 2: 데이터처리 프로세스 세분화](#레벨-2-데이터처리-프로세스-세분화)
  - [위협 식별](#위협-식별)
    - [레벨 0: 전반적 위협 식별](#레벨-0-전반적-위협-식별)
    - [레벨 1: 데이터처리 프로세스별 위협 식별](#레벨-1-데이터처리-프로세스별-위협-식별)
    - [레벨 2: 데이터처리 프로세스 위협 세분화](#레벨-2-데이터처리-프로세스-위협-세분화)
  - [위협 등급 체계](#위협-등급-체계)
    - [DREAD 등급 체계](#dread-등급-체계)
    - [CVSS](#cvss)

---

# 위협 모델의 이해

+ 공격지점: 차량 전반에 걸쳐 영향을 줄 수 있는 각각의 차량 구성 요소가 갖는 취약점들을 이요해 차량을 공격할 수 있는 모든 방법

## 공격 지점 식별

+ 차량을 외부 관점에서 평가
+ 차량 환경 구성에 대해 문서화
+ 차량 외부와 통신하는 경로들을 고려해 데이터가 차량 내부로 들어갈 수 있는 모든 방법 식별

**차량 외부의 공격 지점 식별**
```
어떤 신호들을 수신하는가? 라디오 신호? 키포브? 거리센서?
물리적인 키패드 입력이 존재하는가?
터치나 동작 인식 센서가 존재하는가?
전기 차량일 경우 어떻게 충전하는가?
```

**차량 내부의 공격 지점 식별**
```
오디오 장치에 입력하는 것에는 무엇이 있는가? CD? USB? 블루투스?
차량 진단 포트가 존재하는가?
대시보드가 제공하는 기능은 무엇인가? GPS가 존재하는가? 블루투스가 존재하는가?
인터넷 기능이 존재하는가?
```

## 위협 모델링

+ 개발 시작되는 단계에서 위협 모델 만들어짐
+ 대상의 구조에 관한 정보 수집
+ 차량 내 기능들이 통신하는 방식을 다이어그램으로 표현
+ 다이어그램 맵 중 상대적으로 더 높은 위험을 갖는 데이터 입력 지점들을 식별
+ 입력 지점들을 검사하기 위한 체크리스트 작성

### 레벨 0: 데이터 흐름 파악

+ 차량 내부로 어떻게 데이터가 입력되는지
+ 차량 내외부 구분해 표시
  + 내부: 인포테인먼트/내비게이션 콘솔, USB, OBD-2 연결 단자, CAN 버스 연결 지점
  + 외부: 이동통신, 와이파이, 블루투스, TPMS, KES

### 레벨 1: 데이터 처리 프로세스 분석

+ 레벨 0에서 받아들이는 입력이 차량 내 어디서 처리되는지에 대한 정보 추가
+ 신뢰구간의 경계 구별 (차량 외부 원거리/근거리 통신, 차량 내부, 차량 내부 네트워크)
+ 신뢰구간에 연결되는 통신 채널이 많을수록 통신 채널은 위험 요소가 됨

### 레벨 2: 데이터처리 프로세스 세분화

+ 차량 내부에서 발생하는 통신에 대해 조사
+ 차량과 통신하는 수단들을 신뢰 구간으로 그룹화해 표시
+ 커널 영역(신뢰 구간)에 연결되어 커널과 직접 통신하는 싯템들은 높은 위험성 가짐
+ 다양한 연결 지점을 찾는 과정에서 높은 권한을 갖거나 민감한 정보를 다루는 기능들도 함께 표시

## 위협 식별

### 레벨 0: 전반적 위협 식별

+ 다양한 참가자들과의 브레인스토밍을 통해 각 프로세스와 입력 데이터에 관한 모든 위험 떠올리기
+ 고위협: 원격에서 차량 탈취, 차량 시동/시스템 셧다운, 차량 승객 감시, 차량 도어 열기, 차량 도난, 차량 추적, 안전 시스템 무력화, 차량 내 악성 프로그램 설치

### 레벨 1: 데이터처리 프로세스별 위협 식별

+ 위협을 그룹화해 그룹별 시나리오 세분화
+ 이동통신
  + 어느 곳에서든 차량 내부 네트워크로 연결
  + 착신 전화를 처리하는 인포테인먼트 시스템 내부의 애플리케이션 익스플로잇
  + 인포테인먼트 기기를 통해 SIM에 접근
  + 원격 진단 시스템에 연결하기 위해 이동통신망 활용, 이동통신 도청
  + 전화를 걸어 이동통신 정상 이용 방해
  + 차량 위치 추적
  + 가짜 GSM 기지국 설치
+ 와이파이
  + 300미터 이상 떨어진 곳으로부터 차량 네트워크 연결
  + 와이파이 연결을 처리하는 소프트웨어 익스플로잇
  + 인포테인먼트 기기에 악성 프로그램 설치
  + 와이파이 패스워드 크랙
  + 가짜 딜러 AP를 설치해 차량 와이파이가 인식하게 유도
  + 와이파이 네트워크 통신 가로채기
  + 차량 추적
+ 키포브
  + 비정상적 키포브 요청을 보내 차량 내부 도난 방지 시스템의 오동작 유발
  + 차량 도난 방지 시스템을 통해 차량 배터리를 방전
  + 키를 쓰지 못하게 차량을 잠금
  + 차량 도난 방지 시스템이 연결되는 과정에서 연결 방식에 대한 정보를 유출
  + 키포브의 암호 알고리즘을 무작위 대입
  + 키포브 신호 방해
  + 키포브의 배터리 방전
+ 타이어 공기압 모니터링 센서(TPMS)
  + 비정상적 상태 정보를 ECU에 전송해 익스플로잇 가능성이 있는 에러 유발
  + 도로 상태를 조작해 ECU가 과잉 교정 상태가 되게 속임
  + TPMS 수신기나 ECU를 복구 불가능한 상태로 해 운전자가 차량 상태를 검사하게 한다거나 차량의 시동이 꺼지게 함
  + TPMS의 고유 ID 값을 이용해 차량 추적
  + TPMS 신호를 변조해 내부 경고 알람을 미동작시킴
+ 인포테인먼트 콘솔
  + 인포테인먼트 콘솔을 디버그 모드로 전환시킴
  + 진단 설정을 변경
  + 비정상적인 데이터를 통해 예상하지 못한 동작을 하게 하는 버그 발견
  + 악성 프로그램 설치
  + 악성 프로그램을 이용해 차량 내부 CAN 버스 네트워크 연결
  + 악성 프로그램을 이용해 차량 탑승자들의 행동을 도청, 모니터링
  + 악성 프로그램을 이용해 인포테인먼트 디스플레이에 나오는 차량 위치와 같은 정보를 변조
+ USB
  + USB를 통한 악성 프로그램 설치
  + 인포테인먼트 기기의 USB 스택상 취약점 익스플로잇
  + 인포테인먼트 기기 내 USB 연결을 처리하는 주소록, MP3 디코더와 같은 프로그램들을 공격하게 설계한 특별한 파일들을 포함한 USB 장치 연결
  + 공격자에 의해 수정된 업데이트 소프트웨어 설치
  + USB 포트에 합선을 일으켜 인포테인먼트 시스템 손상
+ 블루투스
  + 인포테인먼트 기기에서 코드 실행
  + 인포테인먼트 기기의 블루투스 스택상의 취약점 익스플로잇
  + 비정상적인 주소록과 같은 악의적인 정보를 업로드해 특정 코드 실행
  + 100m 이내의 가까운 거리에서 차량 연결
  + 블루투스 장치 통신 방해
+ CAN
  + 악의적인 진단 장치를 설치해 CAN 버스로 패킷 전송
  + 직접 CAN 버스에 연결해 키 없이 차량 시동
  + 직접 CAN 버스에 연결해 악성 소프트웨어 업로드
  + 악의적인 진단 장치를 설치해 차량 위치 추적/원격에서 CAN 버스와 통신이 가능하게 해 내부 공격을 외부에서 발생 가능한 위협으로 구성

### 레벨 2: 데이터처리 프로세스 위협 세분화

+ 어떤 애플리케이션이 어떤 연결을 처리하는지 알기 때문에 발생 가능한 위협들을 기반으로 위협 모델링 수행
+ 위협들을 5개 그룹으로 세분화
+ Bluez: 오래되거나 패치가 이뤄지지 않은 버전의 Bluez 데몬
  + 익스플로잇 공격이 가능
  + 변조된 비정상 주소록 데이터 처리 불가
  + 부적합한 암호화 적용
  + 취약한 보안 연결 설정
  + 기본 패스키 사용
+ wpa_supplicant
  + 익스플로잇이 가능한 오래된 버전
  + WPA2 무선 암호화 강제 적용 불가
  + 악성 AP 연결
  + BSSID를 통한 드라이버상 정보 유출
+ HSI
  + 익스플로잇이 가능한 오래된 버전
  + 시리얼 통신 내 데이터 주입 가능
+ udev
  + 공격하기 쉬운 오래되거나 패치가 이뤄지지 않은 버전
  + 화이트리스트 기반의 USB 장치 연결이 구현되지 않아 공격자가 추가적인 드라이버를 로드하거나, 테스트되지 않았거나 악의적인 의도를 가진 USB 장치들을 연결
  + 공격자가 외부 장치들의 연결을 허용함으로써 키보드와 같은 입력 장치를 이용한 인포테인먼트 시스템 접속
+ Kvaser Driver
  + 오래되거나 패치가 이뤄지지 않아 익스플로잇 가능
  + 공격자가 Kvaser 장치에 악성 펌웨어를 업로드하게 허용 가능

## 위협 등급 체계

+ 위험 레벨을 이용해 문서로 작성한 위협들에 대해 등급 평가

### DREAD 등급 체계

+ 일반적으로 웹 테스트 시 사용
+ 자동차 산업 분야/정부에서는 ISO 26262 ASIL과 MIL-STD-882E를 각각 사용

||등급 카테고리|높음(3)|중간(2)|낮음(1)|
|---|---|---|---|---|
|D|잠재적 피해 수준(Damage potential), 얼마나 위험한가?|보안 시스템을 무력화하고 최고 시스템 권한을 획득해 최종적으로 모든 시스템 환경을 장악|민감한 정보 유출 가능|일반적인 정보 유출 가능|
|R|재현 가능성(Reproducibility), 얼마나 쉽게 재현 가능한가?|항상 공격 재현 가능|특정 조건/제한된 시점에만 공격 제현 가능|취약점에 관한 특정 조건이 갖춰져도 공격 재현이 어려움|
|E|익스플로잇 가능성(Exploitability), 얼마나 공격하기 쉬운가?|초보적인 수준의 공격자도 익스플로잇 실행 가능|숙련된 공격자만 반복적으로 공격 수행 가능|깊은 지식을 가진 숙련자만 공격 수행 가능|
|A|영향을 받는 사용자(Affected users), 얼마나 많은 사용자들이 영향을 받는가?|시스템 기본 및 주요 사용자를 포함해 모든 사용자|특정 시스템 기본/일부 사용자|일반적으로 잘 알려지지 않은 시스템 특징과 관련한 극히 일부의 사용자|
|D|위협 발견 수준(Discoverability), 얼마나 쉽게 취약점을 찾을 수 있는가?|공개된 공격에 대한 정보를 통해 쉽게 위협 발견|잘 사용되지 않는 영역에 영향을 주는 위협으로, 공격자의 창의적 노력이 있어야만 발견|위협에 대해 잘 알려지지 않아 익스플로잇할 방법에 대하 찾기 어려움|

### CVSS

+ Base, Temporal, Environmental에서 각각 6개, 3개, 5개 영역과 각 영역들의 하위 영역